var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,c=(e,t)=>{for(var s in t||(t={}))o.call(t,s)&&i(e,s,t[s]);if(r)for(var s of r(t))n.call(t,s)&&i(e,s,t[s]);return e},a=(e,t,s)=>(i(e,"symbol"!=typeof t?t+"":t,s),s);import"./index.5ecc34b2.js";import{l as h}from"./qs.2ee0d5a2.js";import{n as p,m as d}from"./antd.ff053a27.js";var O,f,m={BASE_API:"http://127.0.0.1:3000/v1"};(f=O||(O={}))[f.SUCCESS_CODE=0]="SUCCESS_CODE",f[f.TOKEN_FORMAT_ERROR=9009]="TOKEN_FORMAT_ERROR",f[f.TOKEN_INVALID=9010]="TOKEN_INVALID",f[f.TOKEN_CRYPT_ERROR=9011]="TOKEN_CRYPT_ERROR",f[f.PEOJECT_ACCESS_ERROR=9040]="PEOJECT_ACCESS_ERROR";var E=new class{constructor(){a(this,"serverUrl",m.BASE_API),a(this,"fetch",((e,r={})=>{const o=e.match(/^(http)|(\/\/)/)?e:`${this.serverUrl}${e}`,n=[window.fetch(o,(i=c({},r),a={headers:c({},r.headers?r.headers:{})},t(i,s(a)))),new Promise(((e,t)=>{setTimeout((()=>t(new Error("请求超时"))),6e4)}))];var i,a;return Promise.race(n).then((e=>e)).then(this.checkHttpStatus).then(this.parseResponseResult).then(this.checkBusinessCode).catch((e=>Promise.reject(e)))})),a(this,"toLogin",(()=>{window.location.href=`/login?from_page=${encodeURIComponent(location.href)}`})),a(this,"checkHttpStatus",(e=>{const{status:t,statusText:s,url:r}=e;if(t>=200&&t<300)return e;const o=`请求错误: ${t}[${s}]`;return p.error({message:o,description:r}),Promise.reject(JSON.stringify({message:o,url:r}))})),a(this,"parseResponseResult",(e=>{const t=e.headers.get("Content-Type");return t&&t.indexOf("json")>-1?e.json():t&&t.indexOf("octet-stream")>-1||t&&t.indexOf("image")>-1?e.blob():e.text()})),a(this,"checkBusinessCode",(e=>{if("object"==typeof e&&void 0!==e.code){const t=e,s=t.code,r=t.message;switch(s){case 0:return t;case 9010:case 9009:case 9011:this.toLogin()}return d.error(r),Promise.reject(e)}return e})),a(this,"get",(e=>this.fetch(e,{method:"GET"}))),a(this,"post",((e,t)=>this.fetch(e,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"POST",body:h.stringify(t)}))),a(this,"postJson",((e,t)=>this.fetch(e,{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify(t)}))),a(this,"postFormData",((e,t)=>{const s=new FormData;return Object.keys(t).forEach((e=>{s.append(e,t[e])})),this.fetch(e,{method:"POST",body:s})})),a(this,"putJson",((e,t)=>this.fetch(e,{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"PUT",body:JSON.stringify(t)}))),a(this,"delete",(e=>this.fetch(e,{method:"DELETE"})))}};export{E as r};
